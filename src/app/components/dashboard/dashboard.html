<!-- ===== HEADER ===== -->
<div class="app-header">
  <div class="header-left">
    <button class="header-menu-btn" (click)="toggleSidebar()">☰</button>
    <div class="header-title">Dashboard</div>
  </div>
  <div class="header-datetime">{{ currentDateTime }}</div>
</div>

<!-- ===== SIDEBAR ===== -->
<div class="sidebar" [class.open]="sidebarOpen">
  <div class="username">Hi, {{ user.displayName }}</div>
  <button class="dashboard-btn-base dashboard-btn-blue" (click)="goToProfile()">Profile</button>
  <button class="dashboard-btn-base dashboard-btn-blue" (click)="goToCalendar()">Calendar</button>
  <button class="dashboard-btn-base dashboard-btn-blue" (click)="goToDashboard()">Dashboard</button>
  
  <div class="sidebar-footer">
    <button class="dashboard-btn-base dashboard-btn-red" (click)="logout()">Logout</button>
  </div>
</div>
<div class="sidebar-backdrop" *ngIf="sidebarOpen" (click)="toggleSidebar()"></div>

<!-- ===== MAIN LAYOUT ===== -->
<div class="dashboard-container">

  <!-- LEFT PANE -->
<div class="dashboard-left">
  
  <!-- Sticky Sort + Search -->
  <div class="task-filters">
    <!-- Sort Dropdown -->
    <select [(ngModel)]="selectedSortFilter"
            (change)="applySearchFilter()"
            class="sort-select">
      <option value="all">All</option>
      <option value="completed">Completed</option>
      <option value="incomplete">Incomplete</option>
      <option value="overdue">Out of Due Date</option>
      <option value="neartoduedate">Near to Due Date</option>
    </select>

    <!-- Search Bar -->
    <input type="text"
           class="search-bar"
           placeholder="Search tasks..."
           [(ngModel)]="searchTerm"
           (input)="applySearchFilter()" />
  </div>

  <!-- Tasks List -->
  <div class="tasks-list">
    <div class="task-card"
         *ngFor="let task of filteredTasks"
         (click)="showTaskDetails(task)"
         [ngClass]="{
           'green-top': task.status,
           'red-top': isOverdue(task.dueDate, task.status),
           'orange-top': isDueWithinTwoDays(task.dueDate, task.status),
           'blue-top': !task.status && !isDueWithinTwoDays(task.dueDate, task.status) && !isOverdue(task.dueDate, task.status)
         }">
      <div class="task-title">{{ task.title }}</div>
      <div class="task-status">{{ task.status ? 'Completed' : 'Incomplete' }}</div>
      <div class="task-date">
        {{ task.dueDate | date: 'mediumDate' }} {{ task.dueDate | date: 'HH:mm' }}
      </div>
    </div>
  </div>

</div>


  <!-- CENTER PANE -->
  <div class="dashboard-center">
    <!-- CREATE TASK -->
    <div class="create-task-center">
      <button class="dashboard-btn-base dashboard-btn-blue" (click)="showAddTaskFormToggle()">
        + Create Task
      </button>

      <div *ngIf="showAddTaskForm" class="login-form-style create-task-form">
        <input type="text" [(ngModel)]="newTask.title" placeholder="Task Title" />
        <textarea [(ngModel)]="newTask.description" placeholder="Task Description"></textarea>
        <input type="datetime-local" [(ngModel)]="newTask.dueDate" />
        <button class="dashboard-btn-base dashboard-btn-blue" (click)="createTask()">Create</button>
        <div class="error-message" *ngIf="createError">{{ createError }}</div>
      </div>
    </div>

    <!-- TASK DETAILS -->
    <div *ngIf="selectedTask && !editMode && !showAddTaskForm" class="task-details-pane">
      <h2>{{ selectedTask.title }}</h2>
      <p>{{ selectedTask.description }}</p>
      <p><strong>Created:</strong> {{ selectedTask.createdAt | date: 'fullDate' }} {{ selectedTask.createdAt | date: 'HH:mm' }}</p>
      <p><strong>Updated:</strong> {{ selectedTask.updatedAt | date: 'fullDate' }} {{ selectedTask.updatedAt | date: 'HH:mm' }}</p>
      <p><strong>Due Date:</strong> {{ selectedTask.dueDate | date: 'fullDate' }} {{ selectedTask.dueDate | date: 'HH:mm' }}</p>
      <p><strong>Status:</strong> {{ selectedTask.status ? 'Completed' : 'Incomplete' }}</p>
      <p *ngIf="selectedTask.status && selectedTask.completedAt">
        <strong>Completed On:</strong> {{ selectedTask.completedAt | date: 'fullDate' }} {{ selectedTask.completedAt | date: 'HH:mm' }}
      </p>
      <div class="action-buttons">
        <button class="dashboard-btn-base dashboard-btn-blue" (click)="startEdit(selectedTask)">Edit</button>
        <button class="dashboard-btn-base dashboard-btn-red" (click)="deleteTask(selectedTask.id!)">Delete</button>
        <button class="dashboard-btn-base dashboard-btn-green" (click)="toggleComplete(selectedTask)">
          {{ selectedTask.status ? 'Mark Incomplete' : 'Mark Complete' }}
        </button>
      </div>
    </div>

    <!-- EDIT FORM -->
    <div *ngIf="editMode" class="edit-form">
      <h2>Edit Task</h2>
      <input type="text" [(ngModel)]="editTaskData.title" placeholder="Task Title" />
      <textarea [(ngModel)]="editTaskData.description" placeholder="Task Description"></textarea>
      <input type="datetime-local" [(ngModel)]="editTaskData.dueDate" />
      <div class="form-actions">
        <button class="dashboard-btn-base dashboard-btn-blue" (click)="saveEdit()">Save</button>
        <button class="dashboard-btn-base dashboard-btn-grey" (click)="cancelEdit()">Cancel</button>
      </div>
      <div class="error-message" *ngIf="editError">{{ editError }}</div>
    </div>
  </div>

  <!-- RIGHT PANE -->
  <div class="dashboard-right">
    <div class="summary-box">
      <h3>Task Summary</h3>
      <div class="summary-line total-line">Total Tasks: {{ tasks.length }}</div>
      <div class="summary-line green-line">Completed: {{ completedCount }}</div>
      <div class="summary-line blue-line">Incomplete: {{ incompleteCount }}</div>
      <div class="summary-line red-line">Out of Due Date: {{ overdueCount }}</div>
      <div class="summary-line orange-line">Near to Due Date: {{ dueSoonCount }}</div>
    </div>

    <div class="streak-box">
      <div class="star-icon">★</div>
      <div>
        <div class="streak-number">{{ streakCount }}</div>
        <div class="streak-label">Streak Points</div>
      </div>
    </div>
  </div>
</div>
