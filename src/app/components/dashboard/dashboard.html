<div class="dashboard-container">

  <!-- Top bar for Logout button -->
  <div class="dashboard-header">
    <button class="action-btn logout-btn" (click)="logout()">Logout</button>
  </div>

  <!-- QUOTE BANNER (centered, scrolls on set) -->
  <div *ngIf="quoteMessage" id="quoteBanner" class="quote-banner">
    {{ quoteMessage }}
  </div>

  <h2>Your Tasks</h2>

  <!-- Task Add Form -->
  <form class="task-form" (ngSubmit)="createTask()">
    <input
      type="text"
      [(ngModel)]="newTask.title"
      name="title"
      placeholder="Title"
      required
      [ngModelOptions]="{standalone: true}"
    >
    <input
      type="text"
      [(ngModel)]="newTask.description"
      name="description"
      placeholder="Description"
      required
      [ngModelOptions]="{standalone: true}"
    >
    <input
      type="datetime-local"
      [(ngModel)]="newTask.dueDate"
      name="dueDate"
      required
      [ngModelOptions]="{standalone: true}"
      placeholder="Due Date & Time"
    >
    <button type="submit" class="action-btn">Add Task</button>
  </form>

  <!-- Tasks Table -->
  <table class="task-table" *ngIf="tasks.length > 0; else noTask">
    <thead>
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Status</th>
        <th>Due Date</th>
        <th>Created At</th>
        <th>Updated At</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let task of tasks">
        <!-- Edit mode -->
        <ng-container *ngIf="editTaskId === task.id; else viewMode">
          <td>
            <input
              type="text"
              [(ngModel)]="editTask.title"
              name="editTitle{{task.id}}"
              required
              [ngModelOptions]="{standalone:true}">
          </td>
          <td>
            <input
              type="text"
              [(ngModel)]="editTask.description"
              name="editDesc{{task.id}}"
              required
              [ngModelOptions]="{standalone:true}">
          </td>
          <td>
            <select [(ngModel)]="editTask.status" name="editStatus{{task.id}}" [ngModelOptions]="{standalone:true}">
              <option [ngValue]="false">Pending</option>
              <option [ngValue]="true">Done</option>
            </select>
          </td>
          <td>
            <input
              type="datetime-local"
              [(ngModel)]="editTask.dueDate"
              name="editDueDate{{task.id}}"
              required
              [ngModelOptions]="{standalone:true}">
          </td>
          <td>{{ task.createdAt | date:'short' }}</td>
          <td>{{ task.updatedAt | date:'short' }}</td>
          <td>
            <div class="task-action-group">
              <button class="action-btn" type="button" (click)="updateTask(task)">Save</button>
              <button class="action-btn" type="button" (click)="cancelEdit()">Cancel</button>
            </div>
          </td>
        </ng-container>

        <!-- View mode -->
        <ng-template #viewMode>
          <td>{{ task.title }}</td>
          <td>{{ task.description }}</td>
          <td>{{ task.status ? 'Done ✅' : 'Pending ⏳' }}</td>
          <td>{{ task.dueDate ? (task.dueDate | date:'short') : '—' }}</td>
          <td>{{ task.createdAt | date:'short' }}</td>
          <td>{{ task.updatedAt | date:'short' }}</td>
          <td>
            <div class="task-action-group">
              <button class="action-btn" *ngIf="!task.status" (click)="startEdit(task)">Edit</button>
              <button class="action-btn delete-btn" (click)="deleteTask(task.id!)">Delete</button>
            </div>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </table>

  <ng-template #noTask>
    <p class="no-task-text">No tasks. Add one above to get started!</p>
  </ng-template>
</div>
